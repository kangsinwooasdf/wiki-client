<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¬¸ì„œ ì‘ì„± | êµ¬ì¸ ìœ„í‚¤</title>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/sidebar/css/sidebar.css" />
</head>
<body>

  <!-- ìƒë‹¨ ê³ ì • ì»¨íŠ¸ë¡¤ -->
  <div class="top-right-controls">
    <input type="text" id="search" placeholder="ğŸ” ë¬¸ì„œ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
    <div class="buttons">
      <button onclick="goToList()">ğŸ“š ë¬¸ì„œ ëª©ë¡</button>
      <button onclick="goToEditor()">âœï¸ ìƒˆ ë¬¸ì„œ ì‘ì„±</button>
    </div>
  </div>

  <main>
    <div class="container">
      <aside class="sidebar" id="sidebar-container"></aside>

      <div class="main-grid">
        <div class="content">
          <article class="article-container">
            <div class="article-header">
              <h1 class="article-title">ğŸ“ ë¬¸ì„œ ì‘ì„±</h1>
            </div>

            <div class="article-content">
              <input type="text" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" class="article-text" />
              <textarea id="editor" placeholder="# ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..." class="article-text" style="height: 400px;"></textarea>
              <button class="action-button" onclick="saveDocument()">ğŸ’¾ ì €ì¥í•˜ê³  ë³´ê¸°</button>
            </div>
          </article>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <p class="footer-text">Â© 2025 êµ¬ì¸ ìœ„í‚¤. ììœ ë¡­ê²Œ ì‘ì„±í•˜ê³  ê³µìœ í•˜ëŠ” ì§€ì‹ì˜ ê³µê°„ì…ë‹ˆë‹¤.</p>
    </div>
  </footer>

  <script src="/js/main.js"></script>
  <script src="/sidebar/js/sidebar.js"></script>
  <script>
    const baseURL = 'https://wiki-b.glitch.me';
    const params = new URLSearchParams(window.location.search);
    const docId = params.get('id');

    if (docId) {
      fetch(`${baseURL}/documents/${docId}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById('title').value = data.title || '';
          document.getElementById('editor').value = data.content || '';
        })
        .catch(err => {
          alert('ë¬¸ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          console.error(err);
        });
    }

    async function saveDocument() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('editor').value;

      try {
        let response, data;

        if (docId) {
          response = await fetch(`${baseURL}/documents/${docId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, content })
          });
          data = { id: docId };
        } else {
          response = await fetch(`${baseURL}/documents`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ title, content })
          });
          data = await response.json();
        }

        window.location.href = `/index/index.html?id=${data.id}`;
      } catch (error) {
        alert('ë¬¸ì„œë¥¼ ì €ì¥í•˜ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        console.error(error);
      }
    }
  </script>
</body>
</html>
